---

# Confused about Ansible roles?
# I was too. They're basically just a bit of naming convention magic.
# http://docs.ansible.com/playbooks_roles.html#roles


### Bootstrap the {{ deploy }} user.
### You must call this playbook with an admin user.
### (The included Vagrantfile will use -u vagrant. For DigitalOcean, use -u root.)

- hosts: all
  vars_files:
    - vars/defaults.yml
  sudo: True
  # user: intentionally blank
  roles:
    - { role: create-deploy-user, tags: ['create-deploy-user'] }


- hosts: all
  vars_files:
    - vars/defaults.yml
  remote_user: "{{ deploy }}"
  roles:
    ### Server provisioning roles:
    - { role: linux-prereqs, tags: ['linux-prereqs'] }
    - { role: ufw, tags: ['ufw'] }
    - { role: postgresql, tags: ['postgresql'] }
    - { role: rbenv, tags: ['rbenv'] }
    - { role: ruby, tags: ['ruby'] }
    - { role: papertrail, tags: ['papertrail'] }
    - { role: nginx-passenger, tags: ['nginx-passenger'] }


### XXX: this is not very DRY, how can we improve this?
- hosts: all
  vars_files:
    - vars/defaults.yml
    - vars/site-bikeways.yml
    - vars/site-bikeways.env.yml
  remote_user: "{{ deploy }}"
  roles:
    - { role: site-bikeways, tags: ['site-bikeways'] }


- hosts: all
  vars_files:
    - vars/defaults.yml
    - vars/site-ttchotline.yml
    - vars/site-ttchotline.env.yml
  remote_user: "{{ deploy }}"
  roles:
    - { role: site-ttchotline, tags: ['site-ttchotline'] }
